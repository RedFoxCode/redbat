"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e,t){function n(t,i){if("."!=t[0]&&"/"!=t[0])return e(t);i=i||"root";var s=n.resolve(t);if(!s&&/\.json$/i.test(t))return e("./"+n.basename(t));var r=n.cache[s];if(!r)try{return e(t)}catch(e){throw new Error('failed to require "'+t+'" from '+i+"\n"+e.message+"\n"+e.stack)}return r.exports||(r.exports={},r.call(r.exports,r,r.exports,n.relative(s))),r.exports}n.cache={},n.basename=e("path").basename,n.resolve=function(t){if("."!=t[0])return e.resolve(t);var i="/"===t.slice(-1)?t:t+"/",s=[t,t+".js",i+"index.js",t+".json",i+"index.json"];for(var r in s){var a=s[r];if(n.cache[a])return a}},n.register=function(e,t){n.cache[e]=t},n.relative=function(e){function t(t){if("."!=t[0])return n(t);var i=e.split("/"),s=t.split("/");i.pop();for(var r in s){var a=s[r];".."==a?i.pop():"."!=a&&i.push(a)}return n(i.join("/"),e)}return t.resolve=n.resolve,t.cache=n.cache,t},n.register("./eventemitter.js",function(e,t,n){var i=n("./namespace"),s=n("lodash");e.exports=function(e){var t=this;e=s.defaults(e,{fast:!1,defaultNamespace:"default",id:Math.random()}),this._id=e.id,this.namespaces={},this.namespaces[e.defaultNamespace]=new i(this._id,t),this.namespace=function(n){return n?this.namespaces[n]?this.namespaces[n]:this.namespaces[n]=new i(null,t):this.namespaces[e.defaultNamespace]};var n=this.namespace();return this.on=n.on,this.onFast=n.onFast,this.once=n.once,this.onceFast=n.onceFast,this.wait=n.wait,this.emit=n.emit,this.emitFast=n.emitFast,this.use=n.use,this.listener=n.getListeners,this.pipe=n.pipe,this.unpipe=n.unpipe,e.fast&&(delete this.on,delete this.use,delete this.once,delete this.emit,delete this.pipe,this.on=this.onFast,this.once=this.onceFast,this.emit=this.emitFast),this}}),n.register("./generator.js",function(e,t,n){var i=n("./eventemitter"),s=n("lodash");e.exports=function(){var e=this;this.methods={},this.Generator=function(){var t=this;i.apply(this),s.each(s.keys(e.methods),function(n){if(t[n])throw new Error("Method '"+n+"' already exists");t[n]=e.methods[n]})}}}),n.register("./index.js",function(e,t,n){var i=n("./eventemitter"),s=n("./generator");e.exports={EventEmitter:i,Generator:s}}),n.register("./namespace.js",function(e,t,n){var i=n("overload-js"),s=n("async"),r=n("lodash"),a=i.o,o=function e(t,n){var o=this;return this.listeners=[],this.middlewares=[],this.connected=[],this._id=t||Math.random(),this._on=function(e,t,n,i){var s,a=!i;a&&(i=function(){s(r.slice(arguments))});var c={type:e,ttl:t?t+Date.now():null,handler:i,once:n};return o.listeners.push(c),a?new Promise(function(e,t){s=function(t){e.apply(o,t)}}):o},this.on=i().args(a.any(String,Array),Function).use(function(e,t){return o._on(e,0,!1,t)}).args(a.any(String,Array),Number,Function).use(function(e,t,n){return o._on(e,t,!1,n)}),this.once=i().args(a.any(String,Array),Function).use(function(e,t){return o._on(e,0,!0,t)}).args(a.any(String,Array),Number,Function).use(function(e,t,n){return o._on(e,t,!0,n)}),this.wait=function(e,t){return o._on(e,t,!0,void 0)},this.delete=function(e){return o.getListeners(e,!0),o},this.pipe=function(){return[].push.apply(o.connected,o.namespacifyAll(arguments)),o},this.unpipe=function(e){e=o.namespacify(e),r.each(o.connected,function(t,n){t._id===e._id&&o.connected.splice(n,1)})},this.onFast=function(e,t){return o.listeners.push({type:e,handler:t}),o},this.onceFast=function(e,t){return o.listeners.push({type:e,handler:t,once:!0}),o},this.emit=function(e){var t=r.slice(arguments),n=r.slice(t,1);return r.each(o.connected,function(e){return e&&e.emit.apply(e.namespace?e.namespace():e,t)}),o.executeMiddlewares(e,n,function(){o.executeListeners(e,n)}),o},this.emitFast=function(e){var t=r.slice(arguments,1);r.each(o.listeners,function(n){("string"==typeof n.type?n.type===e:-1!==r.indexOf(n.type,e))&&n.handler.apply(o,t)})},this.use=function(e){return o.middlewares.push(e),o},this.getListeners=function(e,t){return r.filter(o.listeners,function(n,i){if(!n)return!1;if(n.once&&o.listeners.splice(i,1),n.ttl&&n.ttl<Date.now())return o.listeners.splice(i,1),!1;var s="object"===_typeof(n.type)?-1!==r.indexOf(n.type,e):n.type===e;return s&&t&&o.listeners.splice(i,1),s})},this.executeListeners=function(e,t){var n=o.getListeners(e),i=n.length>1;if(n.length)if(i)s.eachSeries(n,function(e,n){e.handler.apply(e,r.concat(t,function(e){n(e||null)}))},function(e){if(e)throw e});else{if(t.length<2)return n[0].handler(t[0]);n[0].handler.apply(n[0],t)}},this.executeMiddlewares=function(e,t,n){if(!o.middlewares.length)return n();s.eachSeries(o.middlewares,function(n,i){var s=function(e){i(e||null)},r=[e,t,n.length>2?s:void 0];n.apply(o,r),2===n.length&&s()},n)},this.namespacifyAll=function(e){return r.map(e,o.namespacify)},this.namespacify=function(t){return t instanceof e?t:n.namespace(t)},this.namespace=o.namespacify,this};e.exports=o}),t.exports=n("./index.js")}(require,module);