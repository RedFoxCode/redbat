"use strict";!function(e,t){function n(t,i){if("."!=t[0]&&"/"!=t[0])return e(t);i=i||"root";var s=n.resolve(t);if(!s&&/\.json$/i.test(t))return e("./"+n.basename(t));var r=n.cache[s];if(!r)try{return e(t)}catch(e){throw new Error('failed to require "'+t+'" from '+i+"\n"+e.message+"\n"+e.stack)}return r.exports||(r.exports={},r.call(r.exports,r,r.exports,n.relative(s))),r.exports}n.cache={},n.basename=e("path").basename,n.resolve=function(t){if("."!=t[0])return e.resolve(t);var i="/"===t.slice(-1)?t:t+"/",s=[t,t+".js",i+"index.js",t+".json",i+"index.json"];for(var r in s){var a=s[r];if(n.cache[a])return a}},n.register=function(e,t){n.cache[e]=t},n.relative=function(e){function t(t){if("."!=t[0])return n(t);var i=e.split("/"),s=t.split("/");i.pop();for(var r in s){var a=s[r];".."==a?i.pop():"."!=a&&i.push(a)}return n(i.join("/"),e)}return t.resolve=n.resolve,t.cache=n.cache,t},n.register("./eventemitter.js",function(e,t,n){var i=n("./namespace"),s=n("lodash");e.exports=function(e){var t=this;e=s.defaults(e,{fast:!1,defaultNamespace:"default",stats:!1,id:Math.random()}),this._id=e.id,this.namespaces={},this.namespaces[e.defaultNamespace]=new i({id:t._id},t),this.namespace=function(n,r){return n?t.namespaces[n]?t.namespaces[n]:t.namespaces[n]=new i(s.defaults(r,{id:Math.random(),stats:e.stats}),t):t.namespaces[e.defaultNamespace]};var n=this.namespace();return this.on=n.on,this.onFast=n.onFast,this.once=n.once,this.onceFast=n.onceFast,this.wait=n.wait,this.emit=n.emit,this.emitFast=n.emitFast,this.use=n.use,this.catch=n.catch,this.listener=n.getListeners,this.pipe=n.pipe,this.unpipe=n.unpipe,this.freeze=n.freeze,this.stats=n.stats,this.reset=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"all";if("all"===n)t.namespaces={},t.namespaces[e.defaultNamespace]=new i(t._id,t);else{if("namespaces"!==n)throw new Error("Cannot reset '"+n+"'");s.each(s.keys(t.namespaces),function(e){return t.namespaces[e].reset()})}},e.fast&&(delete this.on,delete this.use,delete this.once,delete this.emit,delete this.pipe,this.on=this.onFast,this.once=this.onceFast,this.emit=this.emitFast),this}}),n.register("./generator.js",function(e,t,n){var i=n("./eventemitter"),s=n("lodash");e.exports=function(){var e=this;this.methods={},this.Generator=function(){var t=this;i.apply(this),s.each(s.keys(e.methods),function(n){if(t[n])throw new Error("Method '"+n+"' already exists");t[n]=e.methods[n]})}}}),n.register("./index.js",function(e,t,n){var i=n("./eventemitter"),s=n("./namespace"),r=n("./generator");e.exports={EventEmitter:i,Generator:r,Namespace:s}}),n.register("./namespace.js",function(e,t,n){var i=n("overload-js"),s=n("async"),r=n("stream"),a=n("lodash"),c=i.o,o=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this;return this.listeners=[],this.middlewares=[],this.catches=[],this.connected=[],this.listenerStats={},this.freezed=!1,this._id=t.id,this.reset=function(){this.listeners=[],this.middlewares=[],this.catches=[],this.connected=[]},this.freeze=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return e?o.getListeners(e,!1,function(e){e.freezed=t}):o.freezed=t,o},this.unfreeze=function(e){return o.freeze(e,!1)},this.getInputStream=function(){var e=new r.Writable;return e._write=function(e,t,n){var i=e.toString().split(";"),s=decodeURIComponent(i[0]),r=i[1].split(",").map(decodeURIComponent);o._emit(s,r,!1,!0),n()},e},this.getOutputStream=function(){var e=new r.Readable;return e._read=function(){o.useOnce(function(t,n){e.push(encodeURIComponent(t)+";"+n.map(decodeURIComponent).join(","))},!0)},e},this._on=function(e,t,n,i){var s,r=!i;r&&(i=function(){s(a.slice(arguments))});var c={type:e,ttl:t?t+Date.now():null,handler:i,once:n};return o.listeners.push(c),r?new Promise(function(e,t){s=function(t){e.apply(o,t)}}):o},this.on=i().args(c.any(RegExp,String,Array),Function).use(function(e,t){return o._on(e,0,!1,t)}).args(c.any(RegExp,String,Array),Number,Function).use(function(e,t,n){return o._on(e,t,!1,n)}),this.once=i().args(c.any(RegExp,String,Array),Function).use(function(e,t){return o._on(e,0,!0,t)}).args(c.any(RegExp,String,Array),Number,Function).use(function(e,t,n){return o._on(e,t,!0,n)}),this.wait=function(e,t){return o._on(e,t,!0,void 0)},this.delete=function(e){return o.getListeners(e,!0),o},this.pipe=function(){return[].push.apply(o.connected,o.namespacifyAll(arguments)),o},this.unpipe=function(e){e=o.namespacify(e),a.each(o.connected,function(t,n){t._id===e._id&&o.connected.splice(n,1)})},this.onFast=function(e,t){return o.listeners.push({type:e,handler:t}),o},this.onceFast=function(e,t){return o.listeners.push({type:e,handler:t,once:!0}),o},this._emit=function(e,n,i,r){return o.freezed?o:(t.stats&&(o.listenerStats[e]=1+~~o.listenerStats[e]),i||a.each(o.connected,function(t){return t&&t._emit(e,n,!0)}),s.eachSeries([o.executeMiddlewares.bind(o,r),o.executeListeners],function(t,i){t(e,n,i)},function(t){o.triggerError(e,n,t)}),o)},this.emit=function(e){return o._emit(e,a.slice(arguments,1))},this.emitFast=function(e){var t=a.slice(arguments,1);a.each(o.listeners,function(n){("string"==typeof n.type?n.type===e:-1!==a.indexOf(n.type,e))&&n.handler.apply(o,t)})},this.stats=function(){return o.listenerStats},this.use=function(e,t,n){return o.middlewares.push({handler:e,once:t,skip:n}),o},this.useOnce=function(e,t){return o.use(e,!0,t)},this.catch=function(e){return o.catches.push(e),o},this.getListeners=function(e,t,n){return a.filter(o.listeners,function(i,s){if(!i)return!1;if(i.once&&o.listeners.splice(s,1),i.ttl&&i.ttl<Date.now())return o.listeners.splice(s,1),!1;var r;return r=i.type instanceof RegExp?i.type.test(e):Array.isArray(i.type)?-1!==a.indexOf(i.type,e):i.type===e,r&&t?o.listeners.splice(s,1):r&&n&&n(i),!i.freezed&&r})},this.executeListeners=function(e,t,n){var i=o.getListeners(e),r=i.length>1;if(i.length)if(r)s.eachSeries(i,function(e,n){e.handler.apply(e,a.concat(t,function(e){n(e||null)}))},function(e){n(e||null)});else{if(t.length<2)return i[0].handler(t[0]);n(i[0].handler.apply(i[0],t))}},this.executeChain=function(e,t,n,i,r){if(!t.length)return r();var a,c=0;s.eachSeries(t,function(s,r){if(s.skip&&e)return r();var u=function(e){r(e||null)};"function"!=typeof s&&(a=s.once,s=s.handler);var h=s.apply(o,n(s,u));i(s,h,u),a&&t.splice(c,1),c++},r)},this.executeMiddlewares=function(e,t,n,i){o.executeChain(e,o.middlewares,function(e,i){return[t,n,e.length>2?i:void 0]},function(e,t,n){e.length<3&&n(t)},i)},this.triggerError=function(e,t,n){if(n){if(!o.catches.length)throw n;return o.executeChain(!1,o.catches,function(i,s){return[e,t,n,s]},function(e,t,n){e.length<4&&n(t)},function(){}),!0}},this.namespacifyAll=function(e){return a.map(e,o.namespacify)},this.namespacify=function(t){return t instanceof e?t:n.namespace(t)},this.namespace=n.namespace,this};e.exports=o}),t.exports=n("./index.js")}(require,module);